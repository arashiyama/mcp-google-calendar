<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Calendar MCP Client</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 20px;
            padding-bottom: 60px;
            background-color: #f8f9fa;
        }
        .navbar {
            margin-bottom: 30px;
            background-color: #4285f4;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
            border: 1px solid #dee2e6;
        }
        .btn-primary {
            background-color: #4285f4;
            border-color: #4285f4;
        }
        .btn-success {
            background-color: #34a853;
            border-color: #34a853;
        }
        .btn-danger {
            background-color: #ea4335;
            border-color: #ea4335;
        }
        .btn-warning {
            background-color: #fbbc05;
            border-color: #fbbc05;
        }
        .example-buttons {
            margin: 15px 0;
        }
        .action-group {
            margin-bottom: 30px;
        }
        .tab-content {
            padding: 20px;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        .tab-pane {
            padding: 10px;
        }
        #main-tabs {
            margin-bottom: 30px;
        }
        .wrapper {
            max-width: 1200px;
            margin: 0 auto;
        }
        #calendar {
            height: 600px;
            background-color: #fff;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .api-key-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }
        .login-alert {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Google Calendar MCP Client</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link active" href="#main-tabs" data-bs-toggle="tab" data-bs-target="#api-tab">API Explorer</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#main-tabs" data-bs-toggle="tab" data-bs-target="#calendar-tab">Calendar View</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#main-tabs" data-bs-toggle="tab" data-bs-target="#keys-tab">API Keys</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#main-tabs" data-bs-toggle="tab" data-bs-target="#docs-tab">Documentation</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="/logout" id="logoutLink" style="display:none">Logout</a>
                        </li>
                        <li class="nav-item">
                            <a class="btn btn-outline-light" href="#" id="loginLink" style="display:none">Login with Google</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        
        <div class="tab-content" id="main-tabs">
            <!-- API Explorer Tab -->
            <div class="tab-pane fade show active" id="api-tab">
                <div class="container-fluid">
                    <h2>API Explorer</h2>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="action-group">
                                <h5>Actions</h5>
                                <ul class="nav nav-pills flex-column" id="actions-tab">
                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="pill" href="#core-actions">Core Calendar</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="pill" href="#recurring-actions">Recurring Events</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="pill" href="#batch-actions">Batch Operations</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="pill" href="#advanced-actions">Advanced Features</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="pill" href="#webhook-actions">Webhooks</a>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="action-group">
                                <h5>MCP Definition</h5>
                                <button id="fetchDefinition" class="btn btn-secondary btn-sm mb-3">Fetch Definition</button>
                                <div class="collapse" id="definitionCollapse">
                                    <pre id="definition" class="small"></pre>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-8">
                            <div class="tab-content" id="actions-content">
                                <!-- Core Calendar Tab -->
                                <div class="tab-pane fade show active" id="core-actions">
                                    <div class="example-buttons mb-3">
                                        <button class="btn btn-success btn-sm" id="listCalendarsExample">List Calendars</button>
                                        <button class="btn btn-success btn-sm" id="listEventsExample">List Events</button>
                                        <button class="btn btn-success btn-sm" id="createEventExample">Create Event</button>
                                        <button class="btn btn-success btn-sm" id="getEventExample">Get Event</button>
                                        <button class="btn btn-success btn-sm" id="updateEventExample">Update Event</button>
                                        <button class="btn btn-success btn-sm" id="deleteEventExample">Delete Event</button>
                                        <button class="btn btn-success btn-sm" id="findDuplicatesExample">Find Duplicates</button>
                                    </div>
                                </div>
                                
                                <!-- Recurring Events Tab -->
                                <div class="tab-pane fade" id="recurring-actions">
                                    <div class="example-buttons mb-3">
                                        <button class="btn btn-success btn-sm" id="listRecurringInstancesExample">List Recurring Instances</button>
                                        <button class="btn btn-success btn-sm" id="createRecurringEventExample">Create Recurring Event</button>
                                        <button class="btn btn-success btn-sm" id="createEventExceptionExample">Create Event Exception</button>
                                        <button class="btn btn-success btn-sm" id="deleteEventInstanceExample">Delete Event Instance</button>
                                    </div>
                                </div>
                                
                                <!-- Batch Operations Tab -->
                                <div class="tab-pane fade" id="batch-actions">
                                    <div class="example-buttons mb-3">
                                        <button class="btn btn-success btn-sm" id="batchOperationsExample">Batch Operations</button>
                                        <button class="btn btn-success btn-sm" id="batchCreateEventsExample">Batch Create Events</button>
                                        <button class="btn btn-success btn-sm" id="batchEventActionsExample">Batch Event Actions</button>
                                    </div>
                                </div>
                                
                                <!-- Advanced Features Tab -->
                                <div class="tab-pane fade" id="advanced-actions">
                                    <div class="example-buttons mb-3">
                                        <button class="btn btn-success btn-sm" id="advancedSearchExample">Advanced Search</button>
                                        <button class="btn btn-success btn-sm" id="listWithPaginationExample">Paginated Results</button>
                                        <button class="btn btn-success btn-sm" id="eventWithRemindersExample">Event with Reminders</button>
                                        <button class="btn btn-success btn-sm" id="detectConflictsExample">Detect Conflicts</button>
                                        <button class="btn btn-success btn-sm" id="createEventWithConflictCheckExample">Create Event with Conflict Check</button>
                                    </div>
                                </div>
                                
                                <!-- Webhooks Tab -->
                                <div class="tab-pane fade" id="webhook-actions">
                                    <div class="example-buttons mb-3">
                                        <button class="btn btn-success btn-sm" id="createWebhookExample">Create Webhook</button>
                                        <button class="btn btn-success btn-sm" id="listWebhooksExample">List Webhooks</button>
                                        <button class="btn btn-success btn-sm" id="deleteWebhookExample">Delete Webhook</button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="requestBody" class="form-label">Request Body:</label>
                                    <textarea id="requestBody" class="form-control" rows="10">{
  "action": "list_events",
  "parameters": {
    "timeMin": "2023-01-01T00:00:00Z",
    "maxResults": 10
  }
}</textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <button id="executeAction" class="btn btn-primary">Execute</button>
                                </div>
                                
                                <div id="result">
                                    <h5>Response:</h5>
                                    <pre id="response"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Calendar View Tab -->
            <div class="tab-pane fade" id="calendar-tab">
                <div class="container-fluid">
                    <h2>Calendar View</h2>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="calendarSelect" class="form-label">Select Calendar:</label>
                                <select id="calendarSelect" class="form-select">
                                    <option value="primary">Primary Calendar</option>
                                    <!-- Other calendars will be populated dynamically -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="viewSelect" class="form-label">View:</label>
                                <select id="viewSelect" class="form-select">
                                    <option value="month">Month</option>
                                    <option value="week">Week</option>
                                    <option value="day">Day</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4 d-flex align-items-end">
                            <button id="refreshCalendar" class="btn btn-primary">Refresh Calendar</button>
                        </div>
                    </div>
                    
                    <div id="calendar"></div>
                </div>
            </div>
            
            <!-- API Keys Tab -->
            <div class="tab-pane fade" id="keys-tab">
                <div class="container-fluid">
                    <h2>API Keys</h2>
                    <p>Create and manage API keys for accessing the MCP server programmatically.</p>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">Create New API Key</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="keyName" class="form-label">Key Name or Description:</label>
                                        <input type="text" id="keyName" class="form-control" placeholder="e.g., Production App">
                                    </div>
                                    <div class="mb-3">
                                        <label for="keyExpiry" class="form-label">Expiration Date (Optional):</label>
                                        <input type="date" id="keyExpiry" class="form-control">
                                    </div>
                                    <button id="createApiKey" class="btn btn-primary">Create API Key</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h4>Your API Keys</h4>
                            <button id="refreshApiKeys" class="btn btn-secondary mb-3">Refresh List</button>
                            
                            <div id="apiKeysList">
                                <!-- API keys will be populated here -->
                                <div class="text-muted">No API keys found</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-4">
                        <h5>How to use API Keys</h5>
                        <p>Include your API key in the request header or as a query parameter:</p>
                        <ul>
                            <li><strong>Header:</strong> <code>X-API-Key: your_api_key</code></li>
                            <li><strong>Query Parameter:</strong> <code>/mcp/execute?api_key=your_api_key</code></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Documentation Tab -->
            <div class="tab-pane fade" id="docs-tab">
                <div class="container-fluid">
                    <h2>Documentation</h2>
                    
                    <ul class="nav nav-tabs mb-3" id="docsTab">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#overview-tab">Overview</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#auth-tab">Authentication</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#actions-doc-tab">Actions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#webhooks-doc-tab">Webhooks</a>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="overview-tab">
                            <h3>Google Calendar MCP Server</h3>
                            <p>This is a Model Context Protocol (MCP) server implementation for Google Calendar. It allows AI assistants and applications to access and manipulate Google Calendar data in a standardized way.</p>
                            
                            <h4>Features</h4>
                            <ul>
                                <li>Full CRUD operations for Google Calendar events</li>
                                <li>Support for recurring events and exceptions</li>
                                <li>Batch operations for multiple requests</li>
                                <li>Event reminders and notifications</li>
                                <li>Advanced search and filtering</li>
                                <li>Scheduling conflict detection</li>
                                <li>Webhook notifications for calendar changes</li>
                                <li>Database persistence for tokens and webhooks</li>
                            </ul>
                            
                            <h4>Endpoints</h4>
                            <ul>
                                <li><code>/mcp/definition</code> - GET endpoint that returns the capabilities of this MCP server</li>
                                <li><code>/mcp/execute</code> - POST endpoint for executing actions on Google Calendar</li>
                            </ul>
                        </div>
                        
                        <div class="tab-pane fade" id="auth-tab">
                            <h3>Authentication</h3>
                            <p>There are two ways to authenticate with the MCP server:</p>
                            
                            <h4>1. OAuth2 Authentication</h4>
                            <p>Used for web applications or when the user needs to grant permission:</p>
                            <ol>
                                <li>Navigate to the root URL of the server</li>
                                <li>Click the "Login with Google" button</li>
                                <li>Grant permissions to the application</li>
                                <li>You will be redirected back to the application</li>
                            </ol>
                            
                            <h4>2. API Key Authentication</h4>
                            <p>Used for programmatic access:</p>
                            <ol>
                                <li>Create an API key in the "API Keys" tab</li>
                                <li>Include the API key in your requests using either:
                                    <ul>
                                        <li>Header: <code>X-API-Key: your_api_key</code></li>
                                        <li>Query Parameter: <code>/mcp/execute?api_key=your_api_key</code></li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                        
                        <div class="tab-pane fade" id="actions-doc-tab">
                            <h3>Actions</h3>
                            <p>The following actions are supported by the MCP server:</p>
                            
                            <h4>Core Calendar Operations</h4>
                            <ul>
                                <li><strong>list_calendars</strong> - List all available calendars</li>
                                <li><strong>list_events</strong> - List calendar events with filtering options</li>
                                <li><strong>create_event</strong> - Create a new calendar event</li>
                                <li><strong>get_event</strong> - Get details for a specific event</li>
                                <li><strong>update_event</strong> - Update an existing calendar event</li>
                                <li><strong>delete_event</strong> - Delete a calendar event</li>
                                <li><strong>find_duplicates</strong> - Identify potential duplicate events</li>
                                <li><strong>advanced_search_events</strong> - Advanced search with complex filtering</li>
                                <li><strong>detect_conflicts</strong> - Check for scheduling conflicts before creating events</li>
                            </ul>
                            
                            <h4>Recurring Events</h4>
                            <ul>
                                <li><strong>list_recurring_instances</strong> - List all instances of a recurring event</li>
                                <li><strong>create_event_exception</strong> - Create an exception to a specific instance</li>
                                <li><strong>delete_event_instance</strong> - Delete a specific instance of a recurring event</li>
                            </ul>
                            
                            <h4>Batch Operations</h4>
                            <ul>
                                <li><strong>batch_operations</strong> - Execute multiple calendar operations in a single request</li>
                            </ul>
                            
                            <h4>Notifications</h4>
                            <ul>
                                <li><strong>manage_webhooks</strong> - Set up, list, or delete notification webhooks</li>
                            </ul>
                        </div>
                        
                        <div class="tab-pane fade" id="webhooks-doc-tab">
                            <h3>Webhook Notifications</h3>
                            <p>This MCP server supports real-time notifications through webhooks. When events in your calendar change, notifications are sent to the registered webhook endpoints.</p>
                            
                            <h4>Setting up Webhooks</h4>
                            <ol>
                                <li>Create a publicly accessible HTTPS endpoint that can receive POST requests</li>
                                <li>Register your endpoint using the <code>manage_webhooks</code> action with the "create" operation</li>
                                <li>Your server will start receiving notifications when calendar events change</li>
                            </ol>
                            
                            <h4>Webhook Notification Format</h4>
                            <p>Event update notifications:</p>
                            <pre>{
  "type": "calendar_update",
  "events": [
    {
      "id": "event_id",
      "summary": "Event Title",
      "start": { "dateTime": "2023-01-15T09:00:00-07:00" },
      "end": { "dateTime": "2023-01-15T10:00:00-07:00" },
      "status": "confirmed",
      "updated": "2023-01-10T12:34:56Z"
    }
  ],
  "channelId": "webhook_id",
  "timestamp": "2023-01-10T12:34:56Z"
}</pre>
                            
                            <p>Event reminder notifications:</p>
                            <pre>{
  "type": "event_reminder",
  "events": [
    {
      "id": "event_id",
      "summary": "Upcoming Event",
      "start": { "dateTime": "2023-01-15T09:00:00-07:00" },
      "end": { "dateTime": "2023-01-15T10:00:00-07:00" },
      "location": "Conference Room",
      "status": "confirmed"
    }
  ],
  "timestamp": "2023-01-15T08:45:00Z"
}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    
    <script>
        // Initialize tabs and tooltips
        document.addEventListener('DOMContentLoaded', function() {
            // Debug message to verify script is running
            console.log("DOM fully loaded - initializing components");
            
            try {
                // Initialize Bootstrap components
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            
            // Initialize the calendar once the tab is shown
            const calendarTabEl = document.querySelector('a[data-bs-target="#calendar-tab"]');
            calendarTabEl.addEventListener('shown.bs.tab', function() {
                initializeCalendar();
            });
            
            // Initialize API key management
            document.getElementById('createApiKey').addEventListener('click', createApiKey);
            document.getElementById('refreshApiKeys').addEventListener('click', loadApiKeys);
            
            // Initialize example buttons
            document.getElementById('listCalendarsExample').addEventListener('click', listCalendarsExample);
            document.getElementById('listEventsExample').addEventListener('click', listEventsExample);
            document.getElementById('createEventExample').addEventListener('click', createEventExample);
            document.getElementById('getEventExample').addEventListener('click', getEventExample);
            document.getElementById('updateEventExample').addEventListener('click', updateEventExample);
            document.getElementById('deleteEventExample').addEventListener('click', deleteEventExample);
            document.getElementById('findDuplicatesExample').addEventListener('click', findDuplicatesExample);
            
            // Recurring events
            document.getElementById('listRecurringInstancesExample').addEventListener('click', listRecurringInstancesExample);
            document.getElementById('createRecurringEventExample').addEventListener('click', createRecurringEventExample);
            document.getElementById('createEventExceptionExample').addEventListener('click', createEventExceptionExample);
            document.getElementById('deleteEventInstanceExample').addEventListener('click', deleteEventInstanceExample);
            
            // Batch operations
            document.getElementById('batchOperationsExample').addEventListener('click', batchOperationsExample);
            document.getElementById('batchCreateEventsExample').addEventListener('click', batchCreateEventsExample);
            document.getElementById('batchEventActionsExample').addEventListener('click', batchEventActionsExample);
            
            // Advanced features
            document.getElementById('advancedSearchExample').addEventListener('click', advancedSearchExample);
            document.getElementById('listWithPaginationExample').addEventListener('click', listWithPaginationExample);
            document.getElementById('eventWithRemindersExample').addEventListener('click', eventWithRemindersExample);
            document.getElementById('detectConflictsExample').addEventListener('click', detectConflictsExample);
            document.getElementById('createEventWithConflictCheckExample').addEventListener('click', createEventWithConflictCheckExample);
            
            // Webhooks
            document.getElementById('createWebhookExample').addEventListener('click', createWebhookExample);
            document.getElementById('listWebhooksExample').addEventListener('click', listWebhooksExample);
            document.getElementById('deleteWebhookExample').addEventListener('click', deleteWebhookExample);
            
            // Execute button
            document.getElementById('executeAction').addEventListener('click', executeAction);
            
            // Initialize the definition fetch button
            document.getElementById('fetchDefinition').addEventListener('click', fetchDefinition);
            
            // Check if user is authenticated
            checkAuthentication();
            
            console.log("All event listeners have been attached");
            } catch (error) {
                console.error("Error initializing components:", error);
            }
        });
        
        // Initialize FullCalendar
        function initializeCalendar() {
            // Only initialize if not already initialized
            if (window.calendar) return;
            
            const calendarEl = document.getElementById('calendar');
            window.calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: async function(fetchInfo, successCallback, failureCallback) {
                    try {
                        const response = await fetch('/mcp/execute', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                action: 'list_events',
                                parameters: {
                                    calendarId: document.getElementById('calendarSelect').value,
                                    timeMin: fetchInfo.startStr,
                                    timeMax: fetchInfo.endStr,
                                    maxResults: 250
                                }
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            const events = result.data.events.map(event => ({
                                id: event.id,
                                title: event.summary,
                                start: event.start.dateTime || event.start.date,
                                end: event.end.dateTime || event.end.date,
                                location: event.location,
                                description: event.description,
                                extendedProps: { event }
                            }));
                            successCallback(events);
                        } else {
                            failureCallback(new Error(result.error || 'Failed to fetch events'));
                        }
                    } catch (error) {
                        failureCallback(error);
                    }
                },
                eventDidMount: function(info) {
                    // Add tooltip with event details
                    new bootstrap.Tooltip(info.el, {
                        title: `${info.event.title}${info.event.extendedProps.location ? ' - ' + info.event.extendedProps.location : ''}`,
                        placement: 'top',
                        container: 'body',
                        html: true
                    });
                }
            });
            
            window.calendar.render();
            
            // Update the view when selector changes
            document.getElementById('viewSelect').addEventListener('change', function() {
                window.calendar.changeView(this.value);
            });
            
            // Refresh button
            document.getElementById('refreshCalendar').addEventListener('click', function() {
                window.calendar.refetchEvents();
            });
            
            // Load calendars for the selector
            loadCalendars();
        }
        
        // Load available calendars for the selector
        async function loadCalendars() {
            try {
                const response = await fetch('/mcp/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'list_calendars',
                        parameters: {}
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    const select = document.getElementById('calendarSelect');
                    // Clear existing options except the primary
                    while (select.options.length > 1) {
                        select.remove(1);
                    }
                    
                    // Add calendars to selector
                    result.data.forEach(calendar => {
                        if (calendar.id !== 'primary') {
                            const option = document.createElement('option');
                            option.value = calendar.id;
                            option.textContent = calendar.summary;
                            select.appendChild(option);
                        }
                    });
                    
                    // Update calendar when selection changes
                    select.addEventListener('change', function() {
                        window.calendar.refetchEvents();
                    });
                }
            } catch (error) {
                console.error('Error loading calendars:', error);
            }
        }
        
        // API Key Management
        async function createApiKey() {
            const name = document.getElementById('keyName').value.trim();
            
            if (!name) {
                alert('API key name is required');
                return;
            }
            
            try {
                const expiryDate = document.getElementById('keyExpiry').value;
                
                const response = await fetch('/api/keys', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name,
                        expiresAt: expiryDate || null
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    // Show the created key
                    alert(`API key created: ${result.data.key}\n\nMake sure to copy this key now as you won't be able to see it again!`);
                    document.getElementById('keyName').value = '';
                    document.getElementById('keyExpiry').value = '';
                    
                    // Refresh the list
                    loadApiKeys();
                } else {
                    alert(`Error creating API key: ${result.error}`);
                }
            } catch (error) {
                console.error('Error creating API key:', error);
                alert('Error creating API key');
            }
        }
        
        async function loadApiKeys() {
            try {
                const response = await fetch('/api/keys');
                const result = await response.json();
                
                const keysContainer = document.getElementById('apiKeysList');
                keysContainer.innerHTML = '';
                
                if (result.status === 'success' && result.data.length > 0) {
                    result.data.forEach(key => {
                        const keyItem = document.createElement('div');
                        keyItem.className = 'api-key-item';
                        
                        const status = key.isActive ? 
                            '<span class="badge bg-success">Active</span>' : 
                            '<span class="badge bg-danger">Revoked</span>';
                        
                        const expires = key.expiresAt ? 
                            `<div><strong>Expires:</strong> ${new Date(key.expiresAt).toLocaleDateString()}</div>` : 
                            '<div><strong>Expires:</strong> Never</div>';
                        
                        keyItem.innerHTML = `
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h5 class="mb-0">${key.name}</h5>
                                ${status}
                            </div>
                            <div><strong>Key:</strong> ${key.key}</div>
                            <div><strong>Created:</strong> ${new Date(key.createdAt).toLocaleString()}</div>
                            ${expires}
                            <div class="mt-2">
                                <button class="btn btn-sm btn-danger revoke-key" data-key-id="${key.id}">Revoke Key</button>
                            </div>
                        `;
                        
                        keysContainer.appendChild(keyItem);
                    });
                    
                    // Add event listeners for revoke buttons
                    document.querySelectorAll('.revoke-key').forEach(button => {
                        button.addEventListener('click', async function() {
                            const keyId = this.getAttribute('data-key-id');
                            await revokeApiKey(keyId);
                        });
                    });
                } else {
                    keysContainer.innerHTML = '<div class="text-muted">No API keys found</div>';
                }
            } catch (error) {
                console.error('Error loading API keys:', error);
            }
        }
        
        async function revokeApiKey(keyId) {
            if (!confirm('Are you sure you want to revoke this API key? This action cannot be undone.')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/keys/${keyId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    alert('API key revoked successfully');
                    loadApiKeys();
                } else {
                    alert(`Error revoking API key: ${result.error}`);
                }
            } catch (error) {
                console.error('Error revoking API key:', error);
                alert('Error revoking API key');
            }
        }
        
        // Check if user is authenticated
        async function checkAuthentication() {
            try {
                const response = await fetch('/mcp/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'list_calendars',
                        parameters: {}
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'error' && result.error_type === 'authentication_error') {
                    // Not authenticated, add login alert
                    const alertHtml = `
                        <div class="alert alert-warning login-alert">
                            <h4>Authentication Required</h4>
                            <p>You need to authenticate with Google Calendar to use this application.</p>
                            <a href="${result.auth_url}" class="btn btn-primary">Login with Google</a>
                        </div>
                    `;
                    
                    // Insert at the top of each tab
                    document.querySelectorAll('.tab-pane').forEach(tab => {
                        tab.insertAdjacentHTML('afterbegin', alertHtml);
                    });
                    
                    // Hide logout link, show login link
                    document.getElementById('logoutLink').style.display = 'none';
                    const loginLink = document.getElementById('loginLink');
                    loginLink.style.display = 'block';
                    loginLink.href = result.auth_url;
                    
                    console.log("User not authenticated, showing login options");
                } else {
                    // Authenticated, show logout link and load API keys
                    document.getElementById('logoutLink').style.display = 'block';
                    document.getElementById('loginLink').style.display = 'none';
                    loadApiKeys();
                    
                    console.log("User authenticated successfully");
                }
            } catch (error) {
                console.error('Error checking authentication:', error);
            }
        }
        
        // Definition fetching
        async function fetchDefinition() {
            try {
                const response = await fetch('/mcp/definition');
                const data = await response.json();
                document.getElementById('definition').textContent = JSON.stringify(data, null, 2);
                
                // Show the definition
                const definitionCollapse = new bootstrap.Collapse(document.getElementById('definitionCollapse'), {
                    toggle: true
                });
            } catch (error) {
                document.getElementById('definition').textContent = `Error: ${error.message}`;
            }
        }

        // Event Example Handlers
        function listCalendarsExample() {
            document.getElementById('requestBody').value = JSON.stringify({
                action: "list_calendars",
                parameters: {}
            }, null, 2);
        }

        function listEventsExample() {
            document.getElementById('requestBody').value = JSON.stringify({
                action: "list_events",
                parameters: {
                    calendarId: "primary",
                    timeMin: new Date().toISOString(),
                    maxResults: 10
                }
            }, null, 2);
        }
        
        function createEventExample() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(10, 0, 0, 0);
            
            const endTime = new Date(tomorrow);
            endTime.setHours(11, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "create_event",
                parameters: {
                    calendarId: "primary",
                    summary: "Sample Meeting",
                    description: "This is a sample meeting created from the MCP client",
                    location: "Conference Room",
                    start: {
                        dateTime: tomorrow.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    end: {
                        dateTime: endTime.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    }
                }
            }, null, 2);
        }
        
        function getEventExample() {
            // First, try to get a real event ID from a list events call
            fetch('/mcp/execute', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: "list_events",
                    parameters: {
                        calendarId: "primary",
                        timeMin: new Date().toISOString(),
                        maxResults: 1
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                let eventId = "EVENT_ID_HERE";
                
                // If we got an event, use its ID
                if (data.status === 'success' && data.data && data.data.events && data.data.events.length > 0) {
                    eventId = data.data.events[0].id;
                    console.log("Using real event ID:", eventId);
                }
                
                // Update the request body
                document.getElementById('requestBody').value = JSON.stringify({
                    action: "get_event",
                    parameters: {
                        calendarId: "primary",
                        eventId: eventId
                    }
                }, null, 2);
                
                // If we're using the placeholder, show a warning
                if (eventId === "EVENT_ID_HERE") {
                    document.getElementById('response').textContent = "No events found. Please create an event first or replace EVENT_ID_HERE with a valid event ID.";
                }
            })
            .catch(error => {
                console.error("Error getting events:", error);
                document.getElementById('requestBody').value = JSON.stringify({
                    action: "get_event",
                    parameters: {
                        calendarId: "primary",
                        eventId: "EVENT_ID_HERE" // User needs to replace with actual event ID
                    }
                }, null, 2);
                
                document.getElementById('response').textContent = "⚠️ Please replace EVENT_ID_HERE with a valid event ID from your calendar.";
            });
        }
        
        function updateEventExample() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(11, 0, 0, 0);
            
            const endTime = new Date(tomorrow);
            endTime.setHours(12, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "update_event",
                parameters: {
                    calendarId: "primary",
                    eventId: "EVENT_ID_HERE", // User needs to replace with actual event ID
                    summary: "Updated Meeting",
                    description: "This meeting was updated via the MCP client",
                    location: "Virtual Meeting",
                    start: {
                        dateTime: tomorrow.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    end: {
                        dateTime: endTime.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    }
                }
            }, null, 2);
        }
        
        function deleteEventExample() {
            document.getElementById('requestBody').value = JSON.stringify({
                action: "delete_event",
                parameters: {
                    calendarId: "primary",
                    eventId: "EVENT_ID_HERE" // User needs to replace with actual event ID
                }
            }, null, 2);
        }
        
        function findDuplicatesExample() {
            // Default search for duplicate events in the next 90 days
            const now = new Date();
            const ninetyDaysLater = new Date();
            ninetyDaysLater.setDate(now.getDate() + 90);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "find_duplicates",
                parameters: {
                    calendarId: "primary",
                    timeMin: now.toISOString(),
                    timeMax: ninetyDaysLater.toISOString(),
                    similarityThreshold: 0.7
                }
            }, null, 2);
        }
        
        function batchOperationsExample() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(10, 0, 0, 0);
            
            const endTime = new Date(tomorrow);
            endTime.setHours(11, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "batch_operations",
                parameters: {
                    operations: [
                        {
                            action: "create_event",
                            parameters: {
                                summary: "Morning Meeting",
                                start: {
                                    dateTime: tomorrow.toISOString(),
                                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                },
                                end: {
                                    dateTime: endTime.toISOString(),
                                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                }
                            }
                        },
                        {
                            action: "list_events",
                            parameters: {
                                timeMin: new Date().toISOString(),
                                maxResults: 5
                            }
                        }
                    ]
                }
            }, null, 2);
        }
        
        function listWithPaginationExample() {
            document.getElementById('requestBody').value = JSON.stringify({
                action: "list_events",
                parameters: {
                    timeMin: new Date().toISOString(),
                    maxResults: 10,
                    orderBy: "startTime",
                    // Note about pagination
                    // nextPageToken: "PASTE_PAGE_TOKEN_HERE_FROM_PREVIOUS_RESPONSE"
                }
            }, null, 2);
        }
        
        function advancedSearchExample() {
            // Search events for the next 30 days
            const now = new Date();
            const thirtyDaysLater = new Date();
            thirtyDaysLater.setDate(now.getDate() + 30);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "advanced_search_events",
                parameters: {
                    timeRange: {
                        start: now.toISOString(),
                        end: thirtyDaysLater.toISOString()
                    },
                    textSearch: "meeting", // Optional text search term
                    location: "conference", // Optional location filter
                    attendees: ["user@example.com"], // Optional attendees filter
                    status: "confirmed", // Optional status filter
                    isRecurring: true, // Optional filter for recurring events
                    maxResults: 20
                }
            }, null, 2);
        }
        
        // Recurring events examples
        function listRecurringInstancesExample() {
            // First check if we can find a recurring event
            fetch('/mcp/execute', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: "list_events",
                    parameters: {
                        calendarId: "primary",
                        timeMin: new Date().toISOString(),
                        maxResults: 50
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                let eventId = "RECURRING_EVENT_ID_HERE";
                
                // If we got events, look for a recurring one
                if (data.status === 'success' && data.data && data.data.events && data.data.events.length > 0) {
                    // Try to find a recurring event
                    const recurringEvent = data.data.events.find(event => event.recurrence || event.isRecurringEvent);
                    
                    if (recurringEvent) {
                        eventId = recurringEvent.id;
                        console.log("Found recurring event ID:", eventId);
                    } else {
                        console.log("No recurring events found");
                    }
                }
                
                // Update the request body
                document.getElementById('requestBody').value = JSON.stringify({
                    action: "list_recurring_instances",
                    parameters: {
                        calendarId: "primary",
                        eventId: eventId,
                        timeMin: new Date().toISOString(),
                        maxResults: 25
                    }
                }, null, 2);
                
                // If we're using the placeholder, show a warning
                if (eventId === "RECURRING_EVENT_ID_HERE") {
                    document.getElementById('response').textContent = "No recurring events found. Please create a recurring event first or replace RECURRING_EVENT_ID_HERE with a valid recurring event ID.";
                }
            })
            .catch(error => {
                console.error("Error getting events:", error);
                document.getElementById('requestBody').value = JSON.stringify({
                    action: "list_recurring_instances",
                    parameters: {
                        calendarId: "primary",
                        eventId: "RECURRING_EVENT_ID_HERE", // User needs to replace with actual event ID
                        timeMin: new Date().toISOString(),
                        maxResults: 25
                    }
                }, null, 2);
                
                document.getElementById('response').textContent = "⚠️ Please replace RECURRING_EVENT_ID_HERE with a valid recurring event ID from your calendar.";
            });
        }
        
        function createRecurringEventExample() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(10, 0, 0, 0);
            
            const endTime = new Date(tomorrow);
            endTime.setHours(11, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "create_event",
                parameters: {
                    calendarId: "primary",
                    summary: "Weekly Team Meeting",
                    description: "Regular team sync-up meeting",
                    location: "Conference Room A",
                    start: {
                        dateTime: tomorrow.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    end: {
                        dateTime: endTime.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    recurrence: [
                        "RRULE:FREQ=WEEKLY;COUNT=10"
                    ]
                }
            }, null, 2);
        }
        
        function createEventExceptionExample() {
            // Date should be the date of an instance of a recurring event
            const instanceDate = new Date();
            instanceDate.setDate(instanceDate.getDate() + 7); // A week from now
            instanceDate.setHours(10, 0, 0, 0);
            
            const newStartTime = new Date(instanceDate);
            newStartTime.setHours(11, 0, 0, 0); // Change the time
            
            const newEndTime = new Date(newStartTime);
            newEndTime.setHours(12, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "create_event_exception",
                parameters: {
                    calendarId: "primary",
                    recurringEventId: "RECURRING_EVENT_ID_HERE", // User needs to replace with actual recurring event ID
                    originalStartTime: instanceDate.toISOString(),
                    summary: "Special Team Meeting",
                    location: "Virtual Meeting Room",
                    start: {
                        dateTime: newStartTime.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    end: {
                        dateTime: newEndTime.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    reminders: {
                        useDefault: false,
                        overrides: [
                            { method: "email", minutes: 30 },
                            { method: "popup", minutes: 15 }
                        ]
                    }
                }
            }, null, 2);
        }
        
        function deleteEventInstanceExample() {
            // Date should be the date of an instance of a recurring event
            const instanceDate = new Date();
            instanceDate.setDate(instanceDate.getDate() + 14); // Two weeks from now
            instanceDate.setHours(10, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "delete_event_instance",
                parameters: {
                    calendarId: "primary",
                    recurringEventId: "RECURRING_EVENT_ID_HERE", // User needs to replace with actual recurring event ID
                    originalStartTime: instanceDate.toISOString()
                }
            }, null, 2);
        }
        
        // Webhook examples
        function createWebhookExample() {
            document.getElementById('requestBody').value = JSON.stringify({
                action: "manage_webhooks",
                parameters: {
                    operation: "create",
                    address: "https://your-server.com/webhook/calendar"
                }
            }, null, 2);
        }
        
        function listWebhooksExample() {
            document.getElementById('requestBody').value = JSON.stringify({
                action: "manage_webhooks",
                parameters: {
                    operation: "list"
                }
            }, null, 2);
        }
        
        function deleteWebhookExample() {
            document.getElementById('requestBody').value = JSON.stringify({
                action: "manage_webhooks",
                parameters: {
                    operation: "delete",
                    webhookId: "WEBHOOK_ID_HERE" // User needs to replace with actual webhook ID
                }
            }, null, 2);
        }
        
        function eventWithRemindersExample() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(14, 0, 0, 0);
            
            const endTime = new Date(tomorrow);
            endTime.setHours(15, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "create_event",
                parameters: {
                    calendarId: "primary",
                    summary: "Important Meeting with Reminders",
                    description: "Don't forget this meeting!",
                    location: "Conference Room B",
                    start: {
                        dateTime: tomorrow.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    end: {
                        dateTime: endTime.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    reminders: {
                        useDefault: false,
                        overrides: [
                            { method: "email", minutes: 60 },
                            { method: "popup", minutes: 30 },
                            { method: "popup", minutes: 10 }
                        ]
                    }
                }
            }, null, 2);
        }
        
        function batchCreateEventsExample() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const event1Start = new Date(tomorrow);
            event1Start.setHours(9, 0, 0, 0);
            const event1End = new Date(event1Start);
            event1End.setHours(10, 0, 0, 0);
            
            const event2Start = new Date(tomorrow);
            event2Start.setHours(14, 0, 0, 0);
            const event2End = new Date(event2Start);
            event2End.setHours(15, 0, 0, 0);
            
            const event3Start = new Date(tomorrow);
            event3Start.setHours(16, 0, 0, 0);
            const event3End = new Date(event3Start);
            event3End.setHours(17, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "batch_operations",
                parameters: {
                    operations: [
                        {
                            action: "create_event",
                            parameters: {
                                summary: "Morning Standup",
                                start: {
                                    dateTime: event1Start.toISOString(),
                                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                },
                                end: {
                                    dateTime: event1End.toISOString(),
                                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                }
                            }
                        },
                        {
                            action: "create_event",
                            parameters: {
                                summary: "Project Review",
                                start: {
                                    dateTime: event2Start.toISOString(),
                                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                },
                                end: {
                                    dateTime: event2End.toISOString(),
                                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                }
                            }
                        },
                        {
                            action: "create_event",
                            parameters: {
                                summary: "End of Day Wrap-up",
                                start: {
                                    dateTime: event3Start.toISOString(),
                                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                },
                                end: {
                                    dateTime: event3End.toISOString(),
                                    timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                                }
                            }
                        }
                    ]
                }
            }, null, 2);
        }
        
        function batchEventActionsExample() {
            document.getElementById('requestBody').value = JSON.stringify({
                action: "batch_operations",
                parameters: {
                    operations: [
                        {
                            action: "get_event",
                            parameters: {
                                eventId: "EVENT_ID_1_HERE" // Replace with actual event ID
                            }
                        },
                        {
                            action: "update_event",
                            parameters: {
                                eventId: "EVENT_ID_2_HERE", // Replace with actual event ID
                                summary: "Updated Event Title"
                            }
                        },
                        {
                            action: "delete_event",
                            parameters: {
                                eventId: "EVENT_ID_3_HERE" // Replace with actual event ID
                            }
                        }
                    ]
                }
            }, null, 2);
        }
        
        function detectConflictsExample() {
            // Create a proposed event time (tomorrow at 10 AM)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(10, 0, 0, 0);
            
            const endTime = new Date(tomorrow);
            endTime.setHours(11, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "detect_conflicts",
                parameters: {
                    calendarId: "primary",
                    start: {
                        dateTime: tomorrow.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    end: {
                        dateTime: endTime.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    attendees: [
                        "your.email@example.com",  // Replace with actual email
                        "colleague@example.com"    // Replace with actual email
                    ],
                    checkAttendees: true
                }
            }, null, 2);
        }
        
        function createEventWithConflictCheckExample() {
            // Create a proposed event time (tomorrow at 10 AM)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(10, 0, 0, 0);
            
            const endTime = new Date(tomorrow);
            endTime.setHours(11, 0, 0, 0);
            
            document.getElementById('requestBody').value = JSON.stringify({
                action: "create_event",
                parameters: {
                    calendarId: "primary",
                    summary: "Important Meeting",
                    description: "Meeting with conflict detection enabled",
                    location: "Conference Room A",
                    start: {
                        dateTime: tomorrow.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    end: {
                        dateTime: endTime.toISOString(),
                        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
                    },
                    attendees: [
                        "your.email@example.com",  // Replace with actual email
                        "colleague@example.com"    // Replace with actual email
                    ],
                    // Conflict detection parameters
                    checkConflicts: true,
                    allowConflicts: false  // Will fail if conflicts are found
                }
            }, null, 2);
        }
        
        // Execute the action specified in the request body
        async function executeAction() {
            console.log("Execute button clicked");
            try {
                const requestBody = document.getElementById('requestBody').value;
                console.log("Sending request:", requestBody);
                
                const response = await fetch('/mcp/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: requestBody
                });
                
                console.log("Response received, status:", response.status);
                const data = await response.json();
                console.log("Response data:", data);
                
                document.getElementById('response').textContent = JSON.stringify(data, null, 2);
                
                // If not authenticated, provide a link
                if (data.status === 'error' && data.error_type === 'authentication_error' && data.auth_url) {
                    console.log("Authentication required, showing login link");
                    // Show authentication alert if not already shown
                    if (!document.querySelector('.login-alert')) {
                        const alertHtml = `
                            <div class="alert alert-warning login-alert mt-3 mb-3">
                                <h4>Authentication Required</h4>
                                <p>You need to authenticate with Google Calendar to use this application.</p>
                                <a href="${data.auth_url}" class="btn btn-primary">Login with Google</a>
                            </div>
                        `;
                        
                        document.getElementById('result').insertAdjacentHTML('afterbegin', alertHtml);
                    }
                }
            } catch (error) {
                console.error("Error executing action:", error);
                document.getElementById('response').textContent = `Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>